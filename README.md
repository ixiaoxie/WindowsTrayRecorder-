# 🎙️ Mic Recorder (Python)

**简体中文** | [English](README_EN.md)

即开即用的 Windows 本地录音工具，支持全局热键、系统托盘最小化、开机自启等功能。常用于需要随时记录会议和领导需求的办公场景。

![Screenshot](assets/file-20260121155039488.png)

## ✨ 功能特性 (Features)

*   **🎧 高质量录音**: 基于 `PyAudio` 录制 WAV 无损音频。
*   **⌨️ 全局热键**: 支持自定义全局热键，即便软件在后台或在玩游戏时也能响应。
    *   *优化稳定性*: 采用异步线程处理热键，防止“卡死”或被系统移除钩子。
*   **🛡️ 权限管理**: 强制以管理员身份运行，确保热键在任何界面（包括桌面、高权限应用）均生效。
*   **📥 系统托盘集成**: 点击关闭按钮可选择最小化到托盘，支持右键菜单控制。
*   **🚀 开机静默启动**: 支持开机自启，并默认以最小化模式（隐藏窗口）启动，不打扰用户。
*   **🎨 原生 UI**: 简洁的 Tkinter 界面，适配 Windows 原生控件风格，支持中英文切换。
*   **📂 自定义保存路径**: 可以在设置中浏览并选择录音文件的保存文件夹。
*   **⌨️ 智能热键绑定**: 点击热键输入框后，只需按下键盘上的组合键（如 `Ctrl+Shift+A`），即可自动识别并绑定，无需手动输入文本。
*   **🔊 实时状态反馈**: 录音状态改变时会有 Windows 通知提示，托盘图标也会随状态变化。

## 📖 操作指南 (User Guide)

1.  **启动软件**: 运行 `MicRecorder.exe` 或 `mic_recorder.py`。
2.  **设置热键**: 
    *   在“热键配置”区域，点击输入框。
    *   直接按下键盘上的组合键（例如 `Ctrl` + `F1`），软件会自动识别。
    *   配置好“开始/暂停”和“停止”热键后，点击“保存并应用热键”。
3.  **开始录音**: 
    *   按下您设置的开始热键（例如 `Ctrl+2`），或点击界面上的“开始”按钮。
    *   状态栏会显示红色“录音中...”，系统托盘图标也会变化。
4.  **暂停录音**: 
    *   再次按下开始热键，或点击“暂停”按钮。状态栏显示“已暂停”。
5.  **停止与保存**: 
    *   按下停止热键（例如 `Ctrl+3`），或点击“停止”按钮。
    *   录音文件将自动保存到设置的路径中（默认为 `Music\Recordings`）。
6.  **查看录音**: 点击底部的“打开录音文件夹”按钮即可查看刚刚录制的 WAV 文件。

## 🛠️ 技术实现 (Technical Details)

本项目详细展示了如何构建一个完整的 Windows 桌面应用。

### 架构概览

*   **GUI 框架**: 使用标准库 `Tkinter`，配合 `ttk` 主题，无需额外安装庞大的 GUI 库。
*   **录音核心**: `PyAudio` 运行在独立的后台线程中，保证主界面流畅不卡顿。
*   **系统交互**:
    *   `ctypes` 调用 Windows API 实现单实例锁（互斥体）。
    *   `winreg` 修改注册表实现开机自启。

### 关键技术点

1.  **全局热键与防阻塞**:
    *   使用 `keyboard` 库监听全局按键。为了防止录音时的 IO 操作阻塞钩子线程（导致系统移除钩子），热键回调采用了异步执行策略 (`run_async`)。
    *   在 `MainApp` 启动 500ms 后才绑定热键，确保消息循环已就绪。

2.  **UI 状态与线程安全**:
    *   后台录音线程通过回调函数通知 UI 更新状态。
    *   UI 更新必须在主线程执行，因此使用了 `root.after(0, func)` 将任务调度回主队列。

3.  **资源打包**:
    *   通过 `resource_path` 函数处理 PyInstaller 打包后的临时路径 (`_MEIPASS`)，确保图标等资源在 EXE 中能被正确加载。

4.  **智能按键绑定**:
    *   监听输入框的 `focus` 和 `key` 事件，通过位掩码分析 `event.state` 来准确识别 `Ctrl`、`Shift`、`Alt` 等修饰键组合。

## 🛠️ 安装与运行 (Installation)

### 环境要求
*   Windows 10 / 11
*   Python 3.8+

### 1. 克隆代码
```bash
git clone https://github.com/your-username/mic-recorder.git
cd mic-recorder
```

### 2. 安装依赖
```bash
pip install -r requirements.txt
```
*注意：如果不打算打包 EXE，运行时请确保您的 Python 环境有管理员权限，或者以管理员运行 CMD/PowerShell。*

### 3. 运行
```bash
python mic_recorder.py
```

## 📦 打包为 EXE (Build)

如果您想生成一个无需 Python 环境即可运行的 EXE 文件：

1.  确保已安装 PyInstaller：`pip install pyinstaller`
2.  运行构建脚本：`build.bat`
3.  构建完成后，在 `dist` 文件夹中找到 `MicRecorder.exe`。

## ⚠️ 常见问题 (FAQ)

**Q: 为什么运行时会弹出 UAC 提示？**
A: 为了保证**全局热键**在任何场景下（如在全屏游戏或桌面上）都能稳定工作，程序必须拥有管理员权限。

**Q: 开机自启后找不到窗口？**
A: 这是设计的**静默启动**功能。程序已在该后台运行，您可以在屏幕右下角的系统托盘中找到麦克风图标。双击图标即可显示主窗口。

**Q: 杀毒软件误报？**
A: 由于软件使用了全局键盘钩子（监听热键）和开机自启修改注册表，某些敏感的杀软可能会误报。请将程序加入白名单。此项目完全开源，您可以自行审查代码。

## 📜 许可证 (License)

[MIT License](LICENSE)
